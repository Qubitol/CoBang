id: vn.hoabinh.quan.CoBang
runtime: org.gnome.Platform
runtime-version: '48'
sdk: org.gnome.Sdk
command: cobang
finish-args:
  - --share=network
  - --share=ipc
  # Need to access NetworkManager D-Bus API
  - --system-talk-name=org.freedesktop.NetworkManager.*
  - --socket=wayland
  - --socket=fallback-x11
  - --device=dri
cleanup:
  - /include
  - /lib/pkgconfig
  - /man
  - /share/doc
  - /share/gtk-doc
  - /share/man
  - /share/pkgconfig
  - '*.la'
  - '*.a'
modules:

  - name: libzbar
    # Ref: https://gitlab.gnome.org/World/Authenticator
    config-opts:
      - --without-java
      - --without-qt
      - --without-gtk
      - --without-xv
      - --without-imagemagick
      - --disable-video
      - --without-dbus
    sources:
      - type: archive
        url: https://github.com/mchehab/zbar/archive/refs/tags/0.23.93.tar.gz
        sha256: 212dfab527894b8bcbcc7cd1d43d63f5604a07473d31a5f02889e372614ebe28
      - type: script
        dest-filename: autogen.sh
        commands:
          - autoreconf -vfi -W none

  - name: python3-build-tools
    buildsystem: simple
    build-commands: ['python3 -m pip install -U --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} wheel setuptools flit-core cffi gitlint']
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/a3/dc/17031897dae0efacfea57dfd3a82fdd2a2aeb58e0ff71b77b87e44edc772/setuptools-80.9.0-py3-none-any.whl
        sha256: 062d34222ad13e0cc312a4c02d73f059e86a4acbfbdea8f8f76b28c99f306922
      - type: file
        url: https://files.pythonhosted.org/packages/0b/2c/87f3254fd8ffd29e4c02732eee68a83a1d3c346ae39bc6822dcbcb697f2b/wheel-0.45.1-py3-none-any.whl
        sha256: 708e7481cc80179af0e556bbf0cc00b8444c7321e2700b8d8580231d13017248
      - type: file
        url: https://files.pythonhosted.org/packages/f2/65/b6ba90634c984a4fcc02c7e3afe523fef500c4980fec67cc27536ee50acf/flit_core-3.12.0-py3-none-any.whl
        sha256: e7a0304069ea895172e3c7bb703292e992c5d1555dd1233ab7b5621b5b69e62c
      - type: file
        url: https://files.pythonhosted.org/packages/4a/55/b50548b77203e22262002feae23a172f95282b4b8deb5ad104f08e3dc20d/cython-3.1.3-cp312-cp312-manylinux2014_x86_64.manylinux_2_17_x86_64.manylinux_2_28_x86_64.whl
        sha256: 7ac902a17934a6da46f80755f49413bc4c03a569ae3c834f5d66da7288ba7e6c
      - type: file
        url: https://files.pythonhosted.org/packages/68/50/dbe7edefe9b652bc72d49da07785173e89197b9a2d64a2ac45da9795eccf/cython-3.1.3-cp312-cp312-manylinux2014_aarch64.manylinux_2_17_aarch64.manylinux_2_28_aarch64.whl
        sha256: 4b05319e36f34d5388deea5cc2bcfd65f9ebf76f4ea050829421a69625dbba4a
      - type: file
        url: https://files.pythonhosted.org/packages/18/ab/915337fb39ab4f4539a313df38fc69938df3bf14141b90d61dfd5c2919de/cython-3.1.3.tar.gz
        sha256: 10ee785e42328924b78f75a74f66a813cb956b4a9bc91c44816d089d5934c089
      - type: file
        url: https://files.pythonhosted.org/packages/78/2d/7fa73dfa841b5ac06c7b8855cfc18622132e365f5b81d02230333ff26e9e/cffi-2.0.0-cp312-cp312-manylinux2014_x86_64.manylinux_2_17_x86_64.whl
        sha256: 3e17ed538242334bf70832644a32a7aae3d83b57567f9fd60a26257e992b79ba
      - type: file
        url: https://files.pythonhosted.org/packages/d5/72/12b5f8d3865bf0f87cf1404d8c374e7487dcf097a1c91c436e72e6badd83/cffi-2.0.0-cp312-cp312-manylinux2014_aarch64.manylinux_2_17_aarch64.whl
        sha256: b21e08af67b8a103c71a250401c78d5e0893beff75e28c53c98f4de42f774062
      - type: file
        url: https://files.pythonhosted.org/packages/eb/56/b1ba7935a17738ae8453301356628e8147c79dbb825bcbc73dc7401f9846/cffi-2.0.0.tar.gz
        sha256: 44d1b5909021139fe36001ae048dbdde8214afa20200eda0f64c068cac5d5529
      - type: file
        url: https://files.pythonhosted.org/packages/13/a3/a812df4e2dd5696d1f351d58b8fe16a405b234ad2886a0dab9183fb78109/pycparser-2.22-py3-none-any.whl
        sha256: c3702b6d3dd8c7abc1afa565d7e63d53a1d0bd86cdc24edd75470f4de499cfcc
      - type: file
        url: https://files.pythonhosted.org/packages/b0/57/dea471da24ceac6de8c3dc5d37e4ddde57a5c340d6bac90010898734de34/gitlint_core-0.19.1-py3-none-any.whl
        sha256: f41effd1dcbc06ffbfc56b6888cce72241796f517b46bd9fd4ab1b145056988c
      - type: file
        url: https://files.pythonhosted.org/packages/67/67/4bca5a595e2f89bff271724ddb1098e6c9e16f7f3d018d120255e3c30313/arrow-1.2.3-py3-none-any.whl
        sha256: 5a49ab92e3b7b71d96cd6bfcc4df14efefc9dfa96ea19045815914a6ab6b1fe2
      - type: file
        url: https://files.pythonhosted.org/packages/ec/57/56b9bcc3c9c6a792fcbaf139543cee77261f3651ca9da0c93f5c1221264b/python_dateutil-2.9.0.post0-py2.py3-none-any.whl
        sha256: a8b2bc7bffae282281c8140a97d3aa9c14da0b136dfe83f850eea9a5f7470427
      - type: file
        url: https://files.pythonhosted.org/packages/c2/f1/df59e28c642d583f7dacffb1e0965d0e00b218e0186d7858ac5233dce840/click-8.1.3-py3-none-any.whl
        sha256: bb4d8133cb15a609f44e8213d9b391b0809795062913b383c62be0ee95b1db48
      - type: file
        url: https://files.pythonhosted.org/packages/b7/09/89c28aaf2a49f226fef8587c90c6386bd2cc03a0295bc4ff7fc6ee43c01d/sh-1.14.3.tar.gz
        sha256: e4045b6c732d9ce75d571c79f5ac2234edd9ae4f5fa9d59b09705082bdca18c7
      - type: file
        url: https://files.pythonhosted.org/packages/84/90/8b6a29ddceb51272a054399d4864eefd28083530349f5735e0bb979c5f0f/gitlint-0.19.1-py3-none-any.whl
        sha256: 26bb085959148d99fbbc178b4e56fda6c3edd7646b7c2a24d8ee1f8e036ed85d

  - flatpak/generated-sources.yml

  # We don't build GStreamer because org.gnome.Platform 47+ already provides it

  - name: libportal
    buildsystem: meson
    sources:
      - type: archive
        url: https://github.com/flatpak/libportal/archive/refs/tags/0.9.0.tar.gz
        sha256: 0fdf42ca371eeb1213ed25ab0c5681cd51750eb9a3e04adcd6a8dc2af4f4d440

  - name: intltool
    sources:
      - type: archive
        url: https://launchpad.net/intltool/trunk/0.51.0/+download/intltool-0.51.0.tar.gz
        sha256: 67c74d94196b153b774ab9f89b2fa6c6ba79352407037c8c14d5aeb334e959cd

  - name: pwquality
    buildsystem: autotools
    config-opts:
      - --disable-python-bindings
    sources:
      - type: git
        tag: libpwquality-1.4.5
        url: https://github.com/libpwquality/libpwquality.git

  - name: libndp
    buildsystem: autotools
    sources:
      - type: git
        tag: v1.8
        url: https://github.com/jpirko/libndp.git

  # Ref: https://gitlab.gnome.org/GNOME/gnome-control-center/-/tree/main/build-aux/flatpak
  - name: polkit
    buildsystem: meson
    config-opts:
      - -Dauthfw=shadow
      - -Dlibs-only=true
    rm-configure: true
    cleanup:
      - /bin/*
      - /etc/pam.d
      - /etc/dbus-1
      - /share/dbus-1/system-services/*
      - /share/polkit-1
      - /lib/polkit-1
    sources:
      - type: archive
        url: https://github.com/polkit-org/polkit/archive/refs/tags/126.tar.gz
        sha256: 2814a7281989f6baa9e57bd33bbc5e148827e2721ccef22aaf28ab2b376068e8

  - name: udev
    config-opts:
      - --disable-hwdb
      - --disable-logging
      - --disable-gudev
      - --disable-introspection
      - --disable-keymap
      - --disable-mtd_probe
    cleanup:
      - /include
      - /etc
      - /libexec
      - /sbin
      - /lib/pkgconfig
      - /man
      - /share/aclocal
      - /share/doc
      - /share/gtk-doc
      - /share/man
      - /share/pkgconfig
      - '*.la'
      - '*.a'
    sources:
      - type: archive
        url: https://github.com/eudev-project/eudev/archive/refs/tags/v3.2.14.tar.gz
        sha256: c340e6c51dfc5531ac0c0fa84a34b72162acf525f9023eb9cf4931b782c8f177

  - name: NetworkManager
    buildsystem: meson
    build-options:
      cflags: -ltinfo
      cxxflags: -ltinfo
    config-opts:
      - -Dlibaudit=no
      - -Ddbus_conf_dir=/app/etc/dbus-1/system.d
      - -Ddnsmasq=/usr/bin/true
      - -Ddocs=false
      - -Dintrospection=true
      - -Diptables=/usr/bin/true
      - -Dlibpsl=false
      - -Dmodem_manager=false
      - -Dnmtui=false
      - -Dovs=false
      - -Dppp=false
      - -Dqt=false
      - -Dselinux=false
      - -Dsession_tracking=no
      - -Dsystemdsystemunitdir='no'
      - -Dsystemd_journal=false
      - -Dtests=no
      - -Dvapi=false
      - -Dwifi=true
      - -Dnm_cloud_setup=false
      - -Dnbft=false
    sources:
      - type: archive
        url: https://github.com/NetworkManager/NetworkManager/archive/refs/tags/1.54.1.tar.gz
        sha256: 3bec7f01698e416c58fe823d042de87fdc0e5ddf54d1871a8b65216070eb9a93

  - name: blueprint-compiler
    buildsystem: meson
    cleanup:
      - '*'
    sources:
      - type: git
        url: https://gitlab.gnome.org/jwestman/blueprint-compiler
        tag: v0.16.0

  - name: cobang
    builddir: true
    buildsystem: meson
    sources:
      - type: git
        branch: main
        path: .
